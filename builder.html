<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Builder - PolyBot Builder</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="builder.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="builder-page">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="sidebar-logo" title="PolyBot Builder">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="32" height="32" rx="8" fill="url(#gradient)"/>
                    <path d="M16 8L24 12V20L16 24L8 20V12L16 8Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 16L24 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 16V24" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 16L8 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32">
                            <stop offset="0%" stop-color="#00FFA3"/>
                            <stop offset="100%" stop-color="#00B8D4"/>
                        </linearGradient>
                    </defs>
                </svg>
            </button>
            <button class="sidebar-toggle-btn" onclick="toggleSidebar()" title="Toggle sidebar">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="6" height="14" rx="1"/>
                    <path d="M10 6h7M10 10h7M10 14h7"/>
                </svg>
            </button>
        </div>

        <div class="sidebar-actions">
            <button class="sidebar-action-item" onclick="newChat()" title="New chat">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 10h12M10 4v12"/>
                </svg>
                <span class="sidebar-label">New chat</span>
            </button>
            <button class="sidebar-action-item" onclick="searchChats()" title="Search chats">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="9" r="6"/>
                    <path d="M13.5 13.5l4 4"/>
                </svg>
                <span class="sidebar-label">Search chats</span>
            </button>
        </div>

        <div class="chat-list" id="chatList">
            <!-- Chats will be dynamically added here -->
        </div>

        <div class="sidebar-footer">
            <button class="sidebar-menu-item" onclick="openSettings()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="10" cy="10" r="3"/>
                    <path d="M10 1v2M10 17v2M19 10h-2M3 10H1M16.5 16.5l-1.4-1.4M4.9 4.9L3.5 3.5M16.5 3.5l-1.4 1.4M4.9 15.1l-1.4 1.4"/>
                </svg>
                <span class="sidebar-label">Settings</span>
            </button>
            <button class="sidebar-menu-item" onclick="openAccount()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="10" cy="6" r="4"/>
                    <path d="M2 18a8 8 0 0116 0"/>
                </svg>
                <span class="sidebar-label">Account</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Sidebar Toggle (shown when sidebar is collapsed) -->
        <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <line x1="3" y1="5" x2="17" y2="5"/>
                <line x1="3" y1="10" x2="17" y2="10"/>
                <line x1="3" y1="15" x2="17" y2="15"/>
            </svg>
        </button>

        <!-- Top Bar -->
        <div class="builder-topbar">
            <div class="topbar-left">
                <input type="text" id="botName" class="bot-name-input" placeholder="Untitled Bot" />
            </div>
            <div class="topbar-right">
                <span class="autosave-status" id="autosaveStatus">Last saved just now</span>
                <button class="btn-secondary btn-small" onclick="saveDraft()">Save Draft</button>
                <button class="btn-secondary btn-small" onclick="exportBot()">Export</button>
            </div>
        </div>

        <!-- Builder Interface -->
        <div class="builder-container">
            <!-- Left Pane: Chat -->
            <div class="builder-pane chat-pane">
                <!-- Full Screen Welcome (shown on new chat) -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-content">
                        <div class="welcome-badge">
                            <span>New</span>
                            <span>Introducing PolyBot Builder →</span>
                        </div>
                        <h1 class="welcome-title">Build Your Bot</h1>
                        <div class="welcome-input-wrapper">
                            <button class="btn-attach-welcome" title="Attach file">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10 3v14M3 10h14"/>
                                </svg>
                            </button>
                            <input
                                type="text"
                                id="welcomeInput"
                                class="welcome-input"
                                placeholder="Describe your trading strategy..."
                                onkeydown="handleWelcomeKeydown(event)"
                            />
                            <button class="btn-send-welcome" onclick="sendFromWelcome()" title="Send">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M8 12V4M4 8l4-4 4 4"/>
                                </svg>
                            </button>
                        </div>
                        <div class="welcome-examples">
                            <button class="welcome-example" onclick="useWelcomeExample(this)">Create an arbitrage bot</button>
                            <button class="welcome-example" onclick="useWelcomeExample(this)">Build a market maker</button>
                            <button class="welcome-example" onclick="useWelcomeExample(this)">News-driven trading bot</button>
                        </div>
                        <div class="trending-markets">
                            <h3 class="trending-title">Trending Markets</h3>
                            <div class="trending-carousel">
                                <div class="trending-carousel-track" id="trendingCarouselTrack">
                                    <!-- Slide 1 -->
                                    <div class="trending-slide">
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Will Trump win 2024?">
                                            <div class="trending-market-title">Will Trump win 2024?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">54¢</span>
                                                <span class="trending-volume">$2.3M vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Bitcoin above $100K by March?">
                                            <div class="trending-market-title">Bitcoin above $100K by March?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">67¢</span>
                                                <span class="trending-volume">$890K vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Fed rate cut in February?">
                                            <div class="trending-market-title">Fed rate cut in February?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">12¢</span>
                                                <span class="trending-volume">$456K vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="S&P 500 new ATH this month?">
                                            <div class="trending-market-title">S&P 500 new ATH this month?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">78¢</span>
                                                <span class="trending-volume">$623K vol</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Slide 2 -->
                                    <div class="trending-slide">
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="AI surpass human intelligence by 2030?">
                                            <div class="trending-market-title">AI surpass human intelligence by 2030?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">42¢</span>
                                                <span class="trending-volume">$1.2M vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Ethereum above $5K this year?">
                                            <div class="trending-market-title">Ethereum above $5K this year?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">38¢</span>
                                                <span class="trending-volume">$780K vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Recession declared in 2025?">
                                            <div class="trending-market-title">Recession declared in 2025?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">28¢</span>
                                                <span class="trending-volume">$945K vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Tesla stock above $300?">
                                            <div class="trending-market-title">Tesla stock above $300?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">61¢</span>
                                                <span class="trending-volume">$567K vol</span>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Slide 3 -->
                                    <div class="trending-slide">
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Apple releases AR glasses in 2025?">
                                            <div class="trending-market-title">Apple releases AR glasses in 2025?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">19¢</span>
                                                <span class="trending-volume">$432K vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Oil prices above $100/barrel?">
                                            <div class="trending-market-title">Oil prices above $100/barrel?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">33¢</span>
                                                <span class="trending-volume">$654K vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Major tech company IPO in Q1?">
                                            <div class="trending-market-title">Major tech company IPO in Q1?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">47¢</span>
                                                <span class="trending-volume">$389K vol</span>
                                            </div>
                                        </div>
                                        <div class="trending-market" onclick="selectTrendingMarket(this)" data-market="Gold hits new all-time high?">
                                            <div class="trending-market-title">Gold hits new all-time high?</div>
                                            <div class="trending-market-stats">
                                                <span class="trending-price">72¢</span>
                                                <span class="trending-volume">$821K vol</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="carousel-dots" id="carouselDots">
                                    <div class="carousel-dot active" onclick="goToSlide(0)"></div>
                                    <div class="carousel-dot" onclick="goToSlide(1)"></div>
                                    <div class="carousel-dot" onclick="goToSlide(2)"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages (hidden initially) -->
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be added here dynamically -->
                </div>
                <button class="scroll-to-bottom" id="scrollToBottom" onclick="scrollChatToBottom()" style="display: none;">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 4v12M4 10l6 6 6-6"/>
                    </svg>
                </button>
                <div class="market-search-container" id="marketSearchContainer" style="display: none;">
                    <div class="market-search-wrapper">
                        <input
                            type="text"
                            id="marketSearchInput"
                            class="market-search-input"
                            placeholder="Search Polymarket markets..."
                            oninput="searchMarkets(this.value)"
                        />
                        <div class="market-dropdown" id="marketDropdown">
                            <!-- Market suggestions will appear here -->
                        </div>
                    </div>
                </div>
                <div class="recommended-messages" id="recommendedMessages">
                    <!-- Dynamic recommended messages will appear here -->
                </div>
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <button class="btn-attach" title="Attach file">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 3v14M3 10h14"/>
                            </svg>
                        </button>
                        <textarea
                            id="chatInput"
                            placeholder="Ask PolyBot Builder..."
                            rows="1"
                            onkeydown="handleChatKeydown(event)"
                            oninput="autoResizeTextarea(this)"
                        ></textarea>
                    </div>
                    <button class="btn-send" onclick="sendMessage()" id="sendButton">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M8 12V4M4 8l4-4 4 4"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Right Pane: Strategy View -->
            <div class="builder-pane strategy-pane">
                <div class="pane-header">
                    <div class="tab-toggle">
                        <button class="toggle-option active" onclick="switchRightTab('summary')">Summary</button>
                        <button class="toggle-option" onclick="switchRightTab('market')">Market</button>
                        <button class="toggle-option" onclick="switchRightTab('code')">Code</button>
                    </div>
                </div>

                <!-- Summary Tab -->
                <div class="tab-content active" id="summaryTab">
                    <div class="strategy-content">
                        <!-- Market Preview Card -->
                        <div class="glass-card market-preview-card" onclick="switchRightTab('market')">
                            <div class="card-header-inline">
                                <h3>Market Preview</h3>
                                <button class="btn-text-small" onclick="event.stopPropagation(); switchRightTab('market')">Open Market tab →</button>
                            </div>
                            <div class="market-mini-chart">
                                <canvas id="miniSparkline" width="300" height="60"></canvas>
                            </div>
                            <div class="book-snapshot">
                                <div class="book-item"><span class="label">Bid:</span> <span class="value">0.52</span></div>
                                <div class="book-item"><span class="label">Ask:</span> <span class="value">0.54</span></div>
                                <div class="book-item"><span class="label">Mid:</span> <span class="value">0.53</span></div>
                                <div class="book-item"><span class="label">Last:</span> <span class="value">0.53</span></div>
                                <div class="book-item"><span class="label">Spread:</span> <span class="value">0.02</span></div>
                                <div class="book-item"><span class="label">Volume:</span> <span class="value">$12.5K</span></div>
                            </div>
                        </div>

                        <!-- Bot Spec -->
                        <div class="glass-card">
                            <h3>Bot Spec</h3>

                            <div class="spec-row">
                                <span class="spec-label">Trigger</span>
                                <div class="spec-values">
                                    <span>Type: --</span>
                                    <span>Cadence: -- seconds</span>
                                    <span>Data: Not set</span>
                                </div>
                            </div>

                            <div class="spec-section">
                                <div class="spec-section-header">
                                    <span>Entry Rules</span>
                                    <button class="btn-icon-small">+</button>
                                </div>
                                <div class="rule-placeholder">No entry rules defined</div>
                            </div>

                            <div class="spec-section">
                                <div class="spec-section-header">
                                    <span>Exit Rules</span>
                                    <button class="btn-icon-small">+</button>
                                </div>
                                <div class="rule-placeholder">No exit rules defined</div>
                            </div>

                            <div class="spec-row">
                                <span class="spec-label">Sizing</span>
                                <div class="spec-values">
                                    <span>Mode: --</span>
                                    <span>Amount: --</span>
                                    <span>Max position: --</span>
                                </div>
                            </div>

                            <div class="spec-row">
                                <span class="spec-label">Risk Controls</span>
                                <div class="spec-values">
                                    <span>Max trades/day: --</span>
                                    <span>Daily loss cap: --</span>
                                    <span>Cooldown: --</span>
                                    <span>Max spread: --</span>
                                    <span>Slippage guard: --</span>
                                </div>
                            </div>
                        </div>

                        <!-- Connectors -->
                        <div class="glass-card">
                            <h3>Connectors</h3>
                            <div class="connector-list">
                                <label class="connector-toggle">
                                    <input type="checkbox" checked disabled>
                                    <span>Polymarket</span>
                                </label>
                                <label class="connector-toggle">
                                    <input type="checkbox">
                                    <span>RSS</span>
                                </label>
                                <label class="connector-toggle">
                                    <input type="checkbox">
                                    <span>Weather</span>
                                </label>
                                <label class="connector-toggle">
                                    <input type="checkbox">
                                    <span>X (Twitter)</span>
                                </label>
                                <label class="connector-toggle">
                                    <input type="checkbox">
                                    <span>Reddit</span>
                                </label>
                            </div>
                            <div class="connector-secrets">
                                <span class="spec-label">Required secrets:</span>
                                <span>1 (Polymarket API key)</span>
                            </div>
                        </div>

                        <!-- Validation -->
                        <div class="glass-card">
                            <h3>Validation</h3>
                            <div class="validation-chips">
                                <span class="chip chip-missing">3 Missing</span>
                                <span class="chip chip-warning">1 Warning</span>
                                <span class="chip chip-error">0 Errors</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Tab -->
                <div class="tab-content" id="marketTab">
                    <div class="strategy-content">
                        <div class="glass-card">
                            <h3>Market Selection</h3>
                            <p>Market search and full probability chart will appear here.</p>
                            <button class="btn-primary">Use this market</button>
                        </div>
                    </div>
                </div>

                <!-- Code Tab -->
                <div class="tab-content" id="codeTab">
                    <div class="strategy-content">
                        <div class="code-header-actions">
                            <button class="btn-quick-guide" onclick="runQuickGuide()">
                                Run quick guide →
                            </button>
                            <button class="btn-icon" onclick="copyCode()" title="Copy code">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <rect x="5" y="5" width="9" height="9" rx="1"/>
                                    <path d="M3 11V3a1 1 0 011-1h8"/>
                                </svg>
                            </button>
                        </div>
                        <div class="code-content" id="codeContent">
                            <div class="code-placeholder">
                                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="16 18 22 24 16 30"/>
                                    <polyline points="32 18 26 24 32 30"/>
                                </svg>
                                <p>Your bot code will appear here</p>
                                <span>Start by describing your strategy in the chat</span>
                            </div>
                        </div>
                        <div class="code-status">
                            <span class="status-indicator"></span>
                            <span class="status-text">Ready</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="renameChat()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M7 2h5v5M12 2L5 9m-2 2l2-2"/>
            </svg>
            Rename
        </div>
        <div class="context-menu-item" onclick="pinChat()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M7 2v6M4 5l3 3 3-3"/>
            </svg>
            Pin
        </div>
        <div class="context-menu-item danger" onclick="deleteChat()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M2 4h10M5 4V2h4v2M3 4v8a1 1 0 001 1h6a1 1 0 001-1V4"/>
            </svg>
            Delete
        </div>
    </div>

    <!-- Question Modal -->
    <div class="question-modal-overlay" id="questionModalOverlay">
        <div class="question-modal">
            <div class="question-modal-header">
                <h2>Questions</h2>
            </div>
            <div class="question-modal-body" id="questionModalBody">
                <!-- Question content will be dynamically inserted here -->
            </div>
            <div class="question-modal-footer">
                <button class="btn-modal-back" id="modalBackBtn" onclick="handleModalBack()">Back</button>
                <div class="question-progress" id="questionProgress">
                    <!-- Progress dots will be inserted here -->
                </div>
                <button class="btn-modal-next" id="modalNextBtn" onclick="handleModalNext()">Next</button>
            </div>
        </div>
    </div>

    <script src="claude-api.js"></script>
    <script src="builder.js"></script>
</body>
</html>
